<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>管理后台</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="page">
      <header class="hero admin-hero">
        <div class="hero-title">管理后台</div>
        <div class="hero-subtitle">AI 配置与题库维护</div>
        <a class="link back-link" href="/">返回游戏</a>
      </header>

      <section id="adminGate" class="panel admin-gate">
        <div class="panel-title">管理员验证</div>
        <div class="manage-grid">
          <div class="hint">请输入管理员密码后进入。</div>
          <div class="form-row">
            <label class="label" for="adminPassword">密码</label>
            <input id="adminPassword" type="password" placeholder="管理员密码" />
          </div>
          <div class="form-actions">
            <button id="adminLoginBtn" class="btn primary">进入</button>
            <span id="adminStatus" class="summary">未验证</span>
          </div>
        </div>
      </section>

      <div id="adminNotice" class="message is-hidden" hidden style="display: none"></div>

      <div id="adminContent" class="tools-grid is-hidden" hidden style="display: none">
        <section class="panel ai-panel">
          <div class="panel-title">AI 配置</div>
          <div class="manage-grid">
            <div class="hint">
              配置保存在服务器数据库中，切换设备也能读取。
            </div>
            <div class="form-row">
              <label class="label" for="aiProfileSelect">选择配置</label>
              <select id="aiProfileSelect"></select>
            </div>
            <div class="form-row">
              <label class="label" for="aiProfileName">配置名称</label>
              <input id="aiProfileName" type="text" placeholder="例如：GPT-4o-mini" />
            </div>
            <div class="form-row">
              <label class="label" for="aiBaseUrl">Base URL</label>
              <input id="aiBaseUrl" type="text" placeholder="https://api.openai.com/v1/chat/completions" />
            </div>
            <div class="form-row">
              <label class="label" for="aiModel">模型名称</label>
              <input id="aiModel" type="text" placeholder="gpt-4o-mini" />
            </div>
            <div class="form-row">
              <label class="label" for="aiKey">API Key</label>
              <input id="aiKey" type="password" placeholder="本地保存" />
            </div>
            <div class="form-actions">
              <button id="aiSaveBtn" class="btn primary">保存配置</button>
              <button id="aiDeleteBtn" class="btn ghost">删除配置</button>
            </div>
            <div class="form-row">
              <label class="label" for="aiAccessCode">AI 访问码</label>
              <input id="aiAccessCode" type="text" placeholder="用于限制 AI 使用（明文显示）" />
            </div>
            <div class="form-actions">
              <button id="aiAccessSaveBtn" class="btn ghost">保存访问码</button>
              <button id="aiAccessClearBtn" class="btn ghost">清除访问码</button>
              <span id="aiAccessStatus" class="summary">未设置</span>
            </div>
          </div>
        </section>

        <section class="panel manage-panel">
          <div class="panel-title">题库管理</div>
          <div class="manage-grid">
            <div class="hint">
              可在此快速新增题目，或手动在 <code>data/puzzles/</code> 添加 txt 文件。
            </div>
            <div class="form-row">
              <label class="label" for="newPuzzleId">文件名</label>
              <input id="newPuzzleId" type="text" placeholder="可留空自动生成" />
            </div>
          <div class="form-row">
            <label class="label" for="newPuzzleTitle">标题（首行）</label>
            <input id="newPuzzleTitle" type="text" placeholder="必填" />
          </div>
          <div class="form-row">
            <label class="label" for="aiStyleHint">风格补充</label>
            <input id="aiStyleHint" type="text" placeholder="可留空，如：更偏科普或偏历史" />
          </div>
          <div class="form-row">
            <label class="label" for="newPuzzleBody">正文（多行）</label>
            <textarea id="newPuzzleBody" rows="4" placeholder="可留空"></textarea>
          </div>
          <div class="form-actions">
            <label class="checkbox">
              <input id="overwriteCheck" type="checkbox" />
              允许覆盖同名文件
            </label>
            <button id="generatePuzzleBtn" class="btn ghost">AI 生成正文</button>
            <button id="savePuzzleBtn" class="btn primary">保存题目</button>
          </div>
          </div>
        </section>

        <section class="panel puzzle-list-panel">
          <div class="panel-title">题目列表</div>
          <div class="manage-grid">
            <div class="hint">仅展示你创建的题目；未归属的题目默认归 Admin。</div>
            <div class="daily-auto-row">
              <label class="label" for="dailyAutoCheck">每日题池规则</label>
              <div class="daily-auto-actions">
                <label class="checkbox">
                  <input id="dailyAutoCheck" type="checkbox" />
                  自动将未被游玩的题加入每日题池
                </label>
                <button id="dailyAutoSaveBtn" class="btn ghost small">保存规则</button>
                <span id="dailyAutoStatus" class="summary">未保存</span>
              </div>
            </div>
            <div class="puzzle-filter-grid">
              <div class="form-row">
                <label class="label" for="puzzleSearchInput">搜索题目</label>
                <input id="puzzleSearchInput" type="text" placeholder="标题 / ID / 关键词" />
              </div>
              <div class="form-row">
                <label class="label" for="puzzleFilterSelect">筛选</label>
                <select id="puzzleFilterSelect">
                  <option value="all">全部题目</option>
                  <option value="daily">仅每日题</option>
                  <option value="normal">仅普通题</option>
                  <option value="unplayed">仅未游玩</option>
                  <option value="played">仅已游玩</option>
                </select>
              </div>
            </div>
            <div class="form-actions">
              <button id="refreshPuzzleListBtn" class="btn ghost">刷新列表</button>
            </div>
            <div class="puzzle-group">
              <div class="puzzle-group-title">每日题池</div>
              <div class="puzzle-group-hint">仅展示可参与每日挑战的题目。</div>
              <div id="dailyPuzzleList" class="puzzle-list"></div>
            </div>
            <div class="puzzle-group">
              <div class="puzzle-group-title">普通题库</div>
              <div class="puzzle-group-hint">被玩过的题目不能加入每日题池。</div>
              <div id="normalPuzzleList" class="puzzle-list"></div>
            </div>
          </div>
        </section>

        <section class="panel user-list-panel">
          <div class="panel-title">用户列表</div>
          <div class="manage-grid">
            <div class="form-actions">
              <button id="refreshUserListBtn" class="btn ghost">刷新用户</button>
            </div>
            <div id="userList" class="user-list"></div>
          </div>
        </section>

        <section class="panel author-stats-panel">
          <div class="panel-title">出题排行榜</div>
          <div class="manage-grid">
            <div class="hint">按出题数与被通关次数综合排序。</div>
            <div class="form-actions">
              <button id="refreshAuthorStatsBtn" class="btn ghost">刷新排行</button>
            </div>
            <div id="authorStatsEmpty" class="hint is-hidden">暂无数据</div>
            <ol id="authorStatsList" class="author-stats-list"></ol>
          </div>
        </section>
      </div>
    </div>

    <script src="/admin.js"></script>
  </body>
</html>
